<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>NOTES!</title>
  <link href="./static/global.css" rel="stylesheet" type="text/css" />
</head>

<body>
  <header id="header_id">
    <nav>
      <a id="logo_img">
        <h1 onclick="hide_mainpage()" id="title">NOTES!</h1>
      </a>

      <div id="search_bar" onclick="expandSearchBar()">
        <img src="./static/images/lupa.png" id="magnifying_glass_img" height="25%">
        <input type="search" contenteditable="true" placeholder="Search"></input>
      </div>

      <span class="header_links">
        <div class="button_header">
          <a onclick="hide_content()" data-link>Add Note</a>
          <img src="./static/images/nota.png" id="addnote_img">
        </div>
        <div class="button_header">
          <a onclick="hide_profile()" data-link>Profile</a>
          <img src="./static/images/person.png" id="profile_img">
        </div>
      </span>
    </nav>
  </header>

  <main>

    <!-- LOGIN -->
    <div id="login_section">
      <div id="login_div">
        <h1 id="title">NOTES!</h1>
        <p>Welcome back!</p>
        <form>
          <label for="login_Username">Username:</label><br>
          <input type="text" id="login_Username" name="Username" value="guest">
          <label for="login_Password">Password:</label><br>
          <input type="password" id="login_Password" name="Password" value="COLPASWOR"><br><br>
          <button id="login_button" class="button_createnote" type="button">LOGIN</button>
        </form>
        <h4><a onclick="password_clicked()">Forgot password?</a></h4>
        <h4><a onclick="create_clicked()">I don't have an account (yet) :/</a></h4>
      </div>
    </div>

    <!-- FORGOT PASSWORD -->
    <div id="password_section">
      <div id="login_div">
        <h1 id="title">NOTES!</h1>
        <p>Get yourself a new password!</p>
        <form>
          <label for="forgot_Username">Username:</label><br>
          <input type="text" id="forgot_Username" name="Username"><br>
          <label for="forgot_Password">(New) Password:</label><br>
          <input type="password" id="forgot_Password" name="Password"><br><br>
          <button id="forgot_button" class="button_createnote" type="button">LOGIN</button>
        </form>
        <h4><a onclick="login_clicked()">Actually, I know my password</a></h4>
        <h4><a onclick="create_clicked()">I don't have an account (yet) :/</a></h4>
      </div>
    </div>

    <!-- CREATE ACCOUNT -->
    <div id="create_section">
      <div id="login_div">
        <h1 id="title">NOTES!</h1>
        <p>Hello :)</p>
        <form>
          <label for="create_Username">What's your name?</label><br>
          <input type="text" id="create_Username" name="Username" value="guest"><br>
          <label for="create_Password">Password?</label><br>
          <input type="password" id="create_Password" name="Password" value="COLPASWOR"><br><br>
          <button class="button_createnote" onclick="login_clicked()" type="button">LOGIN</button>
        </form>
        <h4><a onclick="password_clicked()">Forgot password?</a></h4>
        <h4><a onclick="login_clicked()">WAIT! I have an account (oops :P)</a></h4>
      </div>
    </div>

    <!-- MAIN PAGE -->
    <div id="mainpage_section">
      <section>
        <div id="filter_div">
          <h3>Sort by:</h3>
          <select name="filter" id="filter">
            <option value="most seen">Most seen</option>
            <option value="most words">Most words</option>
            <option value="last edited">Last edited</option>
            <option value="last open">Last open</option>
          </select>
        </div>
      </section>
      <div id="notes_container" class="notes_gallery"></div>

    </div>

    <div id="createnote_section">
      <section>
        <div class="block_createnote">
          <h1 contenteditable="true">Note title</h1>
        </div>
        <div class="block_createnote">
          <p contenteditable="true">Note content</p>
        </div>
      </section>
      <section>
        <button class="button_createnote" type="button">Exit</button>
        <button class="button_createnote" onclick="addNote()" type="button">Save note</button>
      </section>
    </div>

    <div id="profile_section">
      <section class="section_profile">
        <img src="./static/images/ -4.jpg" id="profile">
        <div id="buttons_profile_div">
          <button class="button_createnote" type="button">Change profile pic</button>
          <button class="button_createnote" type="button">Delete account</button>
        </div>
      </section>
      <section class="section_profile">
        <div>
          <h3>Name:</h3>
          <p class="user_info">Display user name here</p>
        </div>
        <div>
          <h3>Email:</h3>
          <p class="user_info">Display user email here</p>
        </div>
      </section>
    </div>
  </main>

  <footer></footer>

  <script>
    const section_login = document.getElementById("login_section");
    const section_mainpage = document.getElementById("mainpage_section");
    const notesContainer = document.getElementById("notes_container");

    function showSection(sectionToShow) {
      const sections = [section_login, section_mainpage];
      sections.forEach((section) => {
        section.style.display = section === sectionToShow ? "block" : "none";
      })
      const header = document.getElementById("header_id");
      if (header) {
        header.style.display = "block";
      }


    }


    async function loadNotes() {
      const notesContainer = document.getElementById('notes_container');
      notesContainer.innerHTML = ''; // Clear any existing content

      const owner = 'testuser'; // Replace with the actual username of the logged-in user
      const response = await fetch(`/api/notes?owner=${owner}`);

      if (!response.ok) {
        console.error('Failed to fetch notes, status:', response.status);
        notesContainer.innerHTML = '<p>Error fetching notes</p>';
        return;
      }

      const notes = await response.json();

      notes.forEach(note => {
        const noteElement = document.createElement('div');
        noteElement.classList.add('note');

        const titleSpan = document.createElement('div');
        titleSpan.classList.add('title_note');
        titleSpan.textContent = note.title;

        const contentSpan = document.createElement('div');
        contentSpan.classList.add('content_note');
        contentSpan.textContent = note.content;

        noteElement.appendChild(titleSpan);
        noteElement.appendChild(contentSpan);

        notesContainer.appendChild(noteElement);
    });
    }


    // Call fetchNotes when the page loads
    document.addEventListener('DOMContentLoaded', () => {
      loadNotes();
    });


    document.addEventListener("DOMContentLoaded", () => {
      async function submitLogin() {
        const username = document.getElementById("login_Username").value;
        const password = document.getElementById("login_Password").value;

        const response = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
        })

        if (!response.ok) {
          console.error("Login failed with status:", response.status)
          alert("Login failed.")
          return;
        }

        const result = await response.json()
        if (result.success) {
          console.log("Login successful.")
          showSection(section_mainpage)
          document.body.style.background = "rgba(242, 242, 242, 1)"
          await loadNotes(); // Now calling the defined loadNotes function
        } else {
          alert("Login failed: " + result.message)
        }
      }


      document.getElementById("login_button").addEventListener("click", submitLogin);
    });


  </script>

</body>

</html>